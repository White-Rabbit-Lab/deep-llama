# DeepLlama - ローカル翻訳アプリケーション仕様書

## 1. プロジェクト概要

### 1.1 目的

DeepLlamaは、DeepLのような高品質な翻訳体験を提供しながら、完全にローカルで動作する翻訳ツールです。Ollamaを使用してローカルLLMモデルを活用し、ユーザーのプライバシーを完全に保護します。

### 1.2 主要な特徴

- 完全なオフライン動作
- プライバシー保護（データが外部に送信されない）
- リアルタイム翻訳
- シンプルで洗練されたユーザーインターフェース
- 言語自動検出・切り替え

### 1.3 ターゲットユーザー

プライバシーを重視する個人ユーザー

## 2. 機能要件

### 2.1 翻訳機能

- **対応言語**: 日本語 ⇔ 英語（初期バージョン）
- **翻訳方式**:
  - リアルタイムテキスト入力翻訳
  - コピー&ペーストによる翻訳
- **翻訳トリガー**: ユーザーの入力が一定時間（デフォルト: 500ms）停止した時点で自動翻訳
- **パフォーマンス**: リアルタイム性を重視（速度優先）

### 2.2 言語処理

- **言語自動検出**: 入力されたテキストの言語を自動判定
- **自動言語切り替え**:
  - 原文が日本語 → 翻訳結果を英語
  - 原文が英語 → 翻訳結果を日本語
- **言語検出精度**: 短いテキストでも可能な限り正確な検出

### 2.3 モデル管理

- ユーザーがOllamaで利用可能なモデル名を手動で入力
- 複数のモデルを登録可能
- 翻訳画面でモデルを切り替え可能
- 初回は最初に登録されたモデルを自動選択
- ユーザーが選択したモデルを次回のデフォルトとして記憶

### 2.4 ユーザーインターフェース

- **アプリケーションタイプ**: デスクトップアプリケーション（Electron）
- **デザイン**: DeepLのようなシンプルで洗練されたデザイン
- **レイアウト**: 原文と翻訳結果を横並び表示
- **テーマ**: ライトモード/ダークモード対応
- **起動動作**: 通常のウィンドウとして起動
- **システムトレイ**:
  - アプリケーションアイコンを表示
  - クイック翻訳機能（ホットキーで翻訳ウィンドウを表示）

### 2.5 翻訳結果操作

- **コピー機能**: 翻訳結果にコピーボタンを配置
- **ワンクリックコピー**: ボタンクリックで翻訳結果をクリップボードにコピー
- **コピー成功フィードバック**: コピー完了時の視覚的フィードバック

### 2.6 設定機能

- **テーマ切り替え**: ライト/ダーク/システム設定に従う
- **モデル管理**:
  - モデルの追加/削除
  - デフォルトモデルの表示

### 2.7 エラー処理

- shadcn/uiのsonnerコンポーネントを使用したトースト通知
- 以下のエラーケースに対応:
  - Ollamaサーバーが起動していない
  - 指定されたモデルが存在しない
  - ネットワークエラー（Ollamaとの通信）
  - 言語検出失敗時のフォールバック

## 3. 非機能要件

### 3.1 パフォーマンス

- 翻訳レスポンス時間: 可能な限り高速（モデルに依存）
- 言語検出時間: 100ms以内
- UI応答性: 60fps維持

### 3.2 信頼性

- アプリケーションクラッシュ時の自動復旧
- 設定の永続化
- 翻訳履歴は保存しない（プライバシー保護）

### 3.3 セキュリティ・プライバシー

- すべてのデータ処理はローカルで完結
- 翻訳履歴は保存しない
- 外部への通信は一切行わない

### 3.4 互換性

- **対応OS**: Windows、macOS、Linux
- **必要なソフトウェア**: Ollama（事前インストール必須）

## 4. 画面構成

### 4.1 メイン画面（横並びレイアウト）

```
+------------------------------------------------------------+
|  DeepLlama                           [設定] [_][□][X]      |
+------------------------------------------------------------+
| モデル: [model-name                           v]           |
+------------------------------------------------------------+
| 原文 (自動検出)               | 翻訳結果                    |
| +---------------------------+ | +-------------------------+ |
| |                           | | |                         | |
| |  入力テキストエリア        | | |  翻訳結果表示エリア      | |
| |                           | | |                         | |
| |                           | | |                    [📋] | |
| +---------------------------+ | +-------------------------+ |
| 文字数: 0                     | 検出言語: 日本語             |
+------------------------------------------------------------+
```

### 4.2 設定画面

```
+----------------------------------+
|  設定                    [_][□][X]|
+----------------------------------+
| テーマ                           |
| ( ) ライト                       |
| (•) ダーク                       |
| ( ) システム設定に従う             |
+----------------------------------+
| モデル管理                        |
| +------------------------------+ |
| | model1             [削除]    | |
| | model2 (デフォルト) [削除]    | |
| +------------------------------+ |
| [+ モデルを追加]                  |
+----------------------------------+
```

## 5. 技術仕様

### 5.1 技術スタック

- **フレームワーク**: Electron + React + TypeScript
- **ビルドツール**: Vite
- **UIライブラリ**: shadcn/ui
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand
- **IPCセキュリティ**: tRPCを使用した型安全な通信
- **言語検出**: franc（軽量言語検出ライブラリ）

### 5.2 アーキテクチャ

- レイヤードアーキテクチャを採用
- Main Process: Ollamaとの通信、システム操作、言語検出
- Renderer Process: UI表示、ユーザー入力処理
- 型安全なIPC通信（tRPC）

### 5.3 Ollama統合

- HTTP APIを使用してOllamaサーバーと通信
- ストリーミングレスポンスに対応
- エラーハンドリングとリトライ機能
- モデル存在確認API

### 5.4 言語検出システム

- **ライブラリ**: franc（または同等の軽量ライブラリ）
- **検出対象**: 日本語（ja）、英語（en）
- **フォールバック**: 検出失敗時は前回の言語設定を使用
- **最低文字数**: 3文字以上で検出実行

### 5.5 UI コンポーネント

- **コピーボタン**: クリップボードアイコン（📋）
- **トースト通知**: shadcn/ui sonner
- **言語表示**: 検出された言語の表示
- **レスポンシブ**: ウィンドウサイズに応じた調整

## 6. 詳細機能仕様

### 6.1 言語自動切り替えフロー

1. ユーザーがテキストを入力
2. 入力停止後500ms経過
3. 言語検出を実行
4. 検出結果に基づいて翻訳方向を決定:
   - 日本語検出 → 英語へ翻訳
   - 英語検出 → 日本語へ翻訳
5. Ollamaに翻訳リクエスト送信
6. 翻訳結果を表示

### 6.2 コピー機能フロー

1. ユーザーがコピーボタンをクリック
2. 翻訳結果テキストをクリップボードにコピー
3. ボタンの視覚的フィードバック（色変更など）
4. sonnerでコピー完了通知表示

### 6.3 エラー処理フロー

1. エラー発生
2. エラータイプを判定
3. 適切なエラーメッセージを生成
4. sonnerでエラー通知表示
5. 可能であれば復旧提案を表示

## 7. 開発ガイドライン

### 7.1 コード規約

- TypeScriptの厳格な型チェックを使用
- ESLint + Prettierによるコード整形
- Conventional Commitsに従ったコミットメッセージ

### 7.2 テスト

- 単体テスト: Vitest
- E2Eテスト: Playwright
- カバレッジ目標: 80%以上
- 言語検出機能のユニットテスト必須

### 7.3 パフォーマンス最適化

- 言語検出のデバウンス処理
- 翻訳リクエストのキャンセル機能
- メモリリーク防止

## 8. 今後の拡張可能性

### 8.1 機能拡張案

- 追加言語サポート（中国語、韓国語など）
- ファイル翻訳機能
- 翻訳品質の調整オプション
- カスタムプロンプトのサポート
- ショートカットキーのカスタマイズ

### 8.2 技術的改善案

- モデルの自動検出
- オフラインモデルのバンドル
- 翻訳キャッシュ機能
- より高精度な言語検出

## 9. リリース計画

### 9.1 MVP (Minimum Viable Product)

- 基本的な翻訳機能（日本語⇔英語）
- 言語自動検出・切り替え
- モデル選択機能
- コピー機能
- ダークモード対応
- システムトレイ統合

### 9.2 将来のバージョン

- v1.1: 追加言語サポート
- v1.2: ファイル翻訳機能
- v2.0: カスタムプロンプト機能
